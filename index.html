<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <style>
        /* Your existing CSS here */
    </style>
</head>
<body>

<div class="timer-container">
    <div class="circle" id="timerCircle">
        <div id="timer">25:00</div>
    </div>
    <div class="buttons">
        <button id="pomodoro">Pomo</button>
        <button id="shortBreak">Short</button>
        <button id="longBreak">Long</button>
        <button id="reset">Reset</button>
    </div>
</div>

<!-- Sound notification -->
<audio id="timerSound" src="https://github.com/TheMole3/pomdoro/raw/main/timerdone.mp3" preload="auto"></audio>

<script>
    const timerElement = document.getElementById('timer');
    const timerCircle = document.getElementById('timerCircle');
    const sound = document.getElementById('timerSound');
    let worker;

    if (window.Worker) {
        worker = new Worker('worker.js');

        worker.onmessage = function(event) {
            switch (event.data.type) {
                case 'TICK':
                    timerElement.textContent = formatTime(event.data.timeLeft);
                    break;
                case 'END':
                    timerCircle.classList.remove('pulse');
                    sound.play();
                    if (Notification.permission === 'granted') {
                        new Notification('Time is up!');
                    }
                    break;
                case 'RESET':
                    timerElement.textContent = formatTime(event.data.timeLeft);
                    break;
            }
        };
    }

    function formatTime(seconds) {
        let minutes = Math.floor(seconds / 60);
        let secondsLeft = seconds % 60;
        return `${String(minutes).padStart(2, '0')}:${String(secondsLeft).padStart(2, '0')}`;
    }

    function startCountdown(duration) {
        if (worker) {
            timerCircle.classList.add('pulse');
            worker.postMessage({ type: 'START', duration: duration });
        }
    }

    document.getElementById('pomodoro').addEventListener('click', function() {
        startCountdown(25 * 60); // Default Pomodoro time
    });

    document.getElementById('shortBreak').addEventListener('click', function() {
        startCountdown(5 * 60); // Short break time
    });

    document.getElementById('longBreak').addEventListener('click', function() {
        startCountdown(10 * 60); // Long break time
    });

    document.getElementById('reset').addEventListener('click', function() {
        if (worker) {
            worker.postMessage({ type: 'RESET' });
            timerCircle.classList.remove('pulse');
        }
    });

    if (Notification.permission !== 'granted') {
        Notification.requestPermission();
    }

    // Set initial display
    timerElement.textContent = formatTime(25 * 60);
</script>

</body>
</html>
